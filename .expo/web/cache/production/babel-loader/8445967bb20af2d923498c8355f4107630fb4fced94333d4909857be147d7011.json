{"ast":null,"code":"'use strict';import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _classPrivateFieldLooseBase from\"@babel/runtime/helpers/classPrivateFieldLooseBase\";import _classPrivateFieldLooseKey from\"@babel/runtime/helpers/classPrivateFieldLooseKey\";import{findNodeHandle}from'../platformFunctions/findNodeHandle';import{WorkletEventHandler}from\"../WorkletEventHandler.js\";import{has}from\"./utils.js\";var _managedComponent=_classPrivateFieldLooseKey(\"managedComponent\");var _componentOptions=_classPrivateFieldLooseKey(\"componentOptions\");var _eventViewTag=_classPrivateFieldLooseKey(\"eventViewTag\");export var NativeEventsManager=function(){function NativeEventsManager(component,options){_classCallCheck(this,NativeEventsManager);Object.defineProperty(this,_managedComponent,{writable:true,value:void 0});Object.defineProperty(this,_componentOptions,{writable:true,value:void 0});Object.defineProperty(this,_eventViewTag,{writable:true,value:-1});_classPrivateFieldLooseBase(this,_managedComponent)[_managedComponent]=component;_classPrivateFieldLooseBase(this,_componentOptions)[_componentOptions]=options;_classPrivateFieldLooseBase(this,_eventViewTag)[_eventViewTag]=this.getEventViewTag();}return _createClass(NativeEventsManager,[{key:\"attachEvents\",value:function attachEvents(){var _this=this;executeForEachEventHandler(_classPrivateFieldLooseBase(this,_managedComponent)[_managedComponent].props,function(key,handler){handler.registerForEvents(_classPrivateFieldLooseBase(_this,_eventViewTag)[_eventViewTag],key);});}},{key:\"detachEvents\",value:function detachEvents(){var _this2=this;executeForEachEventHandler(_classPrivateFieldLooseBase(this,_managedComponent)[_managedComponent].props,function(_key,handler){handler.unregisterFromEvents(_classPrivateFieldLooseBase(_this2,_eventViewTag)[_eventViewTag]);});}},{key:\"updateEvents\",value:function updateEvents(prevProps){var _this3=this;var computedEventTag=this.getEventViewTag(true);if(_classPrivateFieldLooseBase(this,_eventViewTag)[_eventViewTag]!==computedEventTag){executeForEachEventHandler(prevProps,function(_key,handler){handler.unregisterFromEvents(_classPrivateFieldLooseBase(_this3,_eventViewTag)[_eventViewTag]);});_classPrivateFieldLooseBase(this,_eventViewTag)[_eventViewTag]=computedEventTag;this.attachEvents();return;}executeForEachEventHandler(prevProps,function(key,prevHandler){var newProp=_classPrivateFieldLooseBase(_this3,_managedComponent)[_managedComponent].props[key];if(!newProp){prevHandler.unregisterFromEvents(_classPrivateFieldLooseBase(_this3,_eventViewTag)[_eventViewTag]);}else if(isWorkletEventHandler(newProp)&&newProp.workletEventHandler!==prevHandler){prevHandler.unregisterFromEvents(_classPrivateFieldLooseBase(_this3,_eventViewTag)[_eventViewTag]);newProp.workletEventHandler.registerForEvents(_classPrivateFieldLooseBase(_this3,_eventViewTag)[_eventViewTag]);}});executeForEachEventHandler(_classPrivateFieldLooseBase(this,_managedComponent)[_managedComponent].props,function(key,handler){if(!prevProps[key]){handler.registerForEvents(_classPrivateFieldLooseBase(_this3,_eventViewTag)[_eventViewTag]);}});}},{key:\"getEventViewTag\",value:function getEventViewTag(){var _classPrivateFieldLoo,_findNodeHandle3;var componentUpdate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var componentAnimatedRef=_classPrivateFieldLooseBase(this,_managedComponent)[_managedComponent]._componentRef;if(componentAnimatedRef.getScrollableNode){var _findNodeHandle;var scrollableNode=componentAnimatedRef.getScrollableNode();if(typeof scrollableNode==='number'){return scrollableNode;}return(_findNodeHandle=findNodeHandle(scrollableNode))!=null?_findNodeHandle:-1;}if((_classPrivateFieldLoo=_classPrivateFieldLooseBase(this,_componentOptions)[_componentOptions])!=null&&_classPrivateFieldLoo.setNativeProps){var _findNodeHandle2;return(_findNodeHandle2=findNodeHandle(_classPrivateFieldLooseBase(this,_managedComponent)[_managedComponent]))!=null?_findNodeHandle2:-1;}if(!componentUpdate){return _classPrivateFieldLooseBase(this,_managedComponent)[_managedComponent].getComponentViewTag();}if(componentAnimatedRef.__nativeTag||componentAnimatedRef._nativeTag){var _ref,_componentAnimatedRef;return(_ref=(_componentAnimatedRef=componentAnimatedRef.__nativeTag)!=null?_componentAnimatedRef:componentAnimatedRef._nativeTag)!=null?_ref:-1;}return(_findNodeHandle3=findNodeHandle(componentAnimatedRef))!=null?_findNodeHandle3:-1;}}]);}();function isWorkletEventHandler(prop){return has('workletEventHandler',prop)&&prop.workletEventHandler instanceof WorkletEventHandler;}function executeForEachEventHandler(props,callback){for(var key in props){var prop=props[key];if(isWorkletEventHandler(prop)){callback(key,prop.workletEventHandler);}}}","map":{"version":3,"names":["_classCallCheck","_createClass","_classPrivateFieldLooseBase","_classPrivateFieldLooseKey","findNodeHandle","WorkletEventHandler","has","_managedComponent","_componentOptions","_eventViewTag","NativeEventsManager","component","options","Object","defineProperty","writable","value","getEventViewTag","key","attachEvents","_this","executeForEachEventHandler","props","handler","registerForEvents","detachEvents","_this2","_key","unregisterFromEvents","updateEvents","prevProps","_this3","computedEventTag","prevHandler","newProp","isWorkletEventHandler","workletEventHandler","_classPrivateFieldLoo","_findNodeHandle3","componentUpdate","arguments","length","undefined","componentAnimatedRef","_componentRef","getScrollableNode","_findNodeHandle","scrollableNode","setNativeProps","_findNodeHandle2","getComponentViewTag","__nativeTag","_nativeTag","_ref","_componentAnimatedRef","prop","callback"],"sources":["C:\\Users\\Jorn\\Documents\\hitster\\node_modules\\react-native-reanimated\\src\\createAnimatedComponent\\NativeEventsManager.ts"],"sourcesContent":["'use strict';\nimport { findNodeHandle } from '../platformFunctions/findNodeHandle';\nimport { WorkletEventHandler } from '../WorkletEventHandler';\nimport type {\n  AnimatedComponentProps,\n  AnimatedComponentRef,\n  IAnimatedComponentInternal,\n  INativeEventsManager,\n  InitialComponentProps,\n} from './commonTypes';\nimport { has } from './utils';\n\nexport class NativeEventsManager implements INativeEventsManager {\n  readonly #managedComponent: ManagedAnimatedComponent;\n  readonly #componentOptions?: ComponentOptions;\n  #eventViewTag = -1;\n\n  constructor(component: ManagedAnimatedComponent, options?: ComponentOptions) {\n    this.#managedComponent = component;\n    this.#componentOptions = options;\n    this.#eventViewTag = this.getEventViewTag();\n  }\n\n  public attachEvents() {\n    executeForEachEventHandler(this.#managedComponent.props, (key, handler) => {\n      handler.registerForEvents(this.#eventViewTag, key);\n    });\n  }\n\n  public detachEvents() {\n    executeForEachEventHandler(\n      this.#managedComponent.props,\n      (_key, handler) => {\n        handler.unregisterFromEvents(this.#eventViewTag);\n      }\n    );\n  }\n\n  public updateEvents(\n    prevProps: AnimatedComponentProps<InitialComponentProps>\n  ) {\n    const computedEventTag = this.getEventViewTag(true);\n    // If the event view tag changes, we need to completely re-mount all events\n    if (this.#eventViewTag !== computedEventTag) {\n      // Remove all bindings from previous props that ran on the old viewTag\n      executeForEachEventHandler(prevProps, (_key, handler) => {\n        handler.unregisterFromEvents(this.#eventViewTag);\n      });\n      // We don't need to unregister from current (new) props, because their events weren't registered yet\n      // Replace the view tag\n      this.#eventViewTag = computedEventTag;\n      // Attach the events with a new viewTag\n      this.attachEvents();\n      return;\n    }\n\n    executeForEachEventHandler(prevProps, (key, prevHandler) => {\n      const newProp = this.#managedComponent.props[key];\n      if (!newProp) {\n        // Prop got deleted\n        prevHandler.unregisterFromEvents(this.#eventViewTag);\n      } else if (\n        isWorkletEventHandler(newProp) &&\n        newProp.workletEventHandler !== prevHandler\n      ) {\n        // Prop got changed\n        prevHandler.unregisterFromEvents(this.#eventViewTag);\n        newProp.workletEventHandler.registerForEvents(this.#eventViewTag);\n      }\n    });\n\n    executeForEachEventHandler(this.#managedComponent.props, (key, handler) => {\n      if (!prevProps[key]) {\n        // Prop got added\n        handler.registerForEvents(this.#eventViewTag);\n      }\n    });\n  }\n\n  private getEventViewTag(componentUpdate: boolean = false) {\n    // Get the tag for registering events - since the event emitting view can be nested inside the main component\n    const componentAnimatedRef = this.#managedComponent\n      ._componentRef as AnimatedComponentRef & {\n      // Fabric\n      __nativeTag?: number;\n      // Paper\n      _nativeTag?: number;\n    };\n    if (componentAnimatedRef.getScrollableNode) {\n      /*\n        In most cases, getScrollableNode() returns a view tag, and findNodeHandle is not required. \n        However, to cover more exotic list cases, we will continue to use findNodeHandle \n        for consistency. For numerical values, findNodeHandle should return the value immediately, \n        as documented here: https://github.com/facebook/react/blob/91061073d57783c061889ac6720ef1ab7f0c2149/packages/react-native-renderer/src/ReactNativePublicCompat.js#L113\n      */\n      const scrollableNode = componentAnimatedRef.getScrollableNode();\n      if (typeof scrollableNode === 'number') {\n        return scrollableNode;\n      }\n      return findNodeHandle(scrollableNode) ?? -1;\n    }\n    if (this.#componentOptions?.setNativeProps) {\n      // This case ensures backward compatibility with components that\n      // have their own setNativeProps method passed as an option.\n      return findNodeHandle(this.#managedComponent) ?? -1;\n    }\n    if (!componentUpdate) {\n      // On the first render of a component, we may already receive a resolved view tag.\n      return this.#managedComponent.getComponentViewTag();\n    }\n    if (componentAnimatedRef.__nativeTag || componentAnimatedRef._nativeTag) {\n      /*\n        Fast path for native refs,\n        _nativeTag is used by Paper components,\n        __nativeTag is used by Fabric components.\n      */\n      return (\n        componentAnimatedRef.__nativeTag ??\n        componentAnimatedRef._nativeTag ??\n        -1\n      );\n    }\n    /*\n      When a component is updated, a child could potentially change and have a different \n      view tag. This can occur with a GestureDetector component.\n    */\n    return findNodeHandle(componentAnimatedRef) ?? -1;\n  }\n}\n\nfunction isWorkletEventHandler(\n  prop: unknown\n): prop is WorkletEventHandlerHolder {\n  return (\n    has('workletEventHandler', prop) &&\n    prop.workletEventHandler instanceof WorkletEventHandler\n  );\n}\n\nfunction executeForEachEventHandler(\n  props: AnimatedComponentProps<InitialComponentProps>,\n  callback: (\n    key: string,\n    handler: InstanceType<typeof WorkletEventHandler>\n  ) => void\n) {\n  for (const key in props) {\n    const prop = props[key];\n    if (isWorkletEventHandler(prop)) {\n      callback(key, prop.workletEventHandler);\n    }\n  }\n}\n\ntype ManagedAnimatedComponent = React.Component<\n  AnimatedComponentProps<InitialComponentProps>\n> &\n  IAnimatedComponentInternal;\n\ntype ComponentOptions = {\n  setNativeProps: (\n    ref: AnimatedComponentRef,\n    props: InitialComponentProps\n  ) => void;\n};\n\ntype WorkletEventHandlerHolder = {\n  workletEventHandler: InstanceType<typeof WorkletEventHandler>;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}